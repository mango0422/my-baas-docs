"use strict";(self.webpackChunkmy_baas_docs=self.webpackChunkmy_baas_docs||[]).push([[2881],{1990:(e,n,r)=>{r.d(n,{R:()=>o,x:()=>i});var t=r(758);const s={},a=t.createContext(s);function o(e){const n=t.useContext(a);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),t.createElement(a.Provider,{value:n},e.children)}},8013:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>c,contentTitle:()=>i,default:()=>u,frontMatter:()=>o,metadata:()=>t,toc:()=>l});const t=JSON.parse('{"id":"msa-architecture/09-outbox-pattern","title":"9. Outbox \ud328\ud134: \uc2e0\ub8b0\ud560 \uc218 \uc788\ub294 \uc774\ubca4\ud2b8 \ubc1c\ud589","description":"\ud2b8\ub79c\uc7ad\uc158 DB\uc640 Kafka \uba54\uc2dc\uc9c0\ub97c 100 % \ub3d9\uae30\ud654\ud558\ub824\uba74 Outbox \ud328\ud134\uc774 \uac70\uc758 \ud544\uc218\uc785\ub2c8\ub2e4.","source":"@site/docs/msa-architecture/09-outbox-pattern.mdx","sourceDirName":"msa-architecture","slug":"/msa-architecture/09-outbox-pattern","permalink":"/my-baas-docs/docs/msa-architecture/09-outbox-pattern","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/msa-architecture/09-outbox-pattern.mdx","tags":[],"version":"current","sidebarPosition":10,"frontMatter":{"id":"09-outbox-pattern","title":"9. Outbox \ud328\ud134: \uc2e0\ub8b0\ud560 \uc218 \uc788\ub294 \uc774\ubca4\ud2b8 \ubc1c\ud589","sidebar_position":10},"sidebar":"tutorialSidebar","previous":{"title":"8. CI/CD & \ubc30\ud3ec \uc804\ub7b5","permalink":"/my-baas-docs/docs/msa-architecture/08-deployment-strategy"},"next":{"title":"10. \uba40\ud2f0 \ud14c\ub10c\uc2dc MSA \uc804\ub7b5","permalink":"/my-baas-docs/docs/msa-architecture/10-multi-tenancy-msa"}}');var s=r(6070),a=r(1990);const o={id:"09-outbox-pattern",title:"9. Outbox \ud328\ud134: \uc2e0\ub8b0\ud560 \uc218 \uc788\ub294 \uc774\ubca4\ud2b8 \ubc1c\ud589",sidebar_position:10},i=void 0,c={},l=[{value:"9.1 \ubb38\uc81c \uc815\uc758",id:"91-\ubb38\uc81c-\uc815\uc758",level:2},{value:"9.2 Outbox \ud328\ud134 \uac1c\ub150",id:"92-outbox-\ud328\ud134-\uac1c\ub150",level:2},{value:"9.3 Spring Boot + Debezium \uad6c\ud604",id:"93-spring-boot--debezium-\uad6c\ud604",level:2},{value:"1\ufe0f\u20e3 \uc2a4\ud0a4\ub9c8 \uc608\uc2dc",id:"1\ufe0f\u20e3-\uc2a4\ud0a4\ub9c8-\uc608\uc2dc",level:3},{value:"2\ufe0f\u20e3 \uc5d4\ud2f0\ud2f0 &amp; \ub808\ud3ec\uc9c0\ud1a0\ub9ac",id:"2\ufe0f\u20e3-\uc5d4\ud2f0\ud2f0--\ub808\ud3ec\uc9c0\ud1a0\ub9ac",level:3},{value:"3\ufe0f\u20e3 \ube44\uc988\ub2c8\uc2a4 \uc11c\ube44\uc2a4 \ub0b4 <strong>\ud55c \ud2b8\ub79c\uc7ad\uc158</strong>",id:"3\ufe0f\u20e3-\ube44\uc988\ub2c8\uc2a4-\uc11c\ube44\uc2a4-\ub0b4-\ud55c-\ud2b8\ub79c\uc7ad\uc158",level:3},{value:"4\ufe0f\u20e3 Debezium Connector \uc124\uc815",id:"4\ufe0f\u20e3-debezium-connector-\uc124\uc815",level:3},{value:"9.4 Armeria \ud658\uacbd \ud301",id:"94-armeria-\ud658\uacbd-\ud301",level:2},{value:"9.5 \uc815\ub9ac",id:"95-\uc815\ub9ac",level:2}];function d(e){const n={blockquote:"blockquote",code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,a.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"\ud2b8\ub79c\uc7ad\uc158 DB\uc640 Kafka \uba54\uc2dc\uc9c0\ub97c 100 % \ub3d9\uae30\ud654"}),"\ud558\ub824\uba74 Outbox \ud328\ud134\uc774 \uac70\uc758 \ud544\uc218\uc785\ub2c8\ub2e4."]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"91-\ubb38\uc81c-\uc815\uc758",children:"9.1 \ubb38\uc81c \uc815\uc758"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"\uc0c1\ud669"}),(0,s.jsx)(n.th,{children:"\ubb38\uc81c"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsxs)(n.td,{children:["JDBC Tx ",(0,s.jsx)(n.strong,{children:"Commit \uc131\uacf5"})," \u2192 Kafka ",(0,s.jsx)(n.strong,{children:"\uc804\uc1a1 \uc2e4\ud328"})]}),(0,s.jsx)(n.td,{children:"\ub370\uc774\ud130\ub294 \uc800\uc7a5\ub410\uc9c0\ub9cc \uc774\ubca4\ud2b8 \ubbf8\ubc1c\ud589 \u2192 \ub2e4\uc6b4\uc2a4\ud2b8\ub9bc \ubd88\uc77c\uce58"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsxs)(n.td,{children:["Kafka ",(0,s.jsx)(n.strong,{children:"\uc804\uc1a1 \uc131\uacf5"})," \u2192 JDBC ",(0,s.jsx)(n.strong,{children:"RollBack"})]}),(0,s.jsx)(n.td,{children:"\uc874\uc7ac\ud558\uc9c0 \uc54a\ub294 \ube44\uc988\ub2c8\uc2a4 \ub370\uc774\ud130 \uc774\ubca4\ud2b8 \ubc1c\ud589"})]})]})]}),"\n",(0,s.jsx)(n.h2,{id:"92-outbox-\ud328\ud134-\uac1c\ub150",children:"9.2 Outbox \ud328\ud134 \uac1c\ub150"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"\ub3d9\uc77c \ud2b8\ub79c\uc7ad\uc158"})," \uc548\uc5d0\uc11c \ube44\uc988\ub2c8\uc2a4 \ud14c\uc774\ube14 + ",(0,s.jsx)(n.strong,{children:"outbox \ud14c\uc774\ube14"})," \uc5d0 \ub808\ucf54\ub4dc \uc0bd\uc785"]}),"\n",(0,s.jsxs)(n.li,{children:["\ucee4\ubc0b \ud6c4 ",(0,s.jsx)(n.strong,{children:"\ubcc4\ub3c4 \ud504\ub85c\uc138\uc2a4"}),"(CDC\xb7\uc2a4\ucf00\uc904\ub7ec)\uac00 outbox \u2192 Kafka \ub85c \uc804\uc1a1"]}),"\n",(0,s.jsxs)(n.li,{children:["\uc131\uacf5 \uc2dc outbox \uc0c1\ud0dc =",(0,s.jsx)(n.code,{children:"PROCESSED"})," \ub85c \uc5c5\ub370\uc774\ud2b8"]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-mermaid",children:"flowchart LR\r\n    A[\ube44\uc988\ub2c8\uc2a4 \uc11c\ube44\uc2a4] --\x3e|INSERT + outbox| B(DB)\r\n    B --\x3e C(CDC / Debezium)\r\n    C --\x3e|Kafka Publish| D[Kafka Topic]\n"})}),"\n",(0,s.jsx)(n.h2,{id:"93-spring-boot--debezium-\uad6c\ud604",children:"9.3 Spring Boot + Debezium \uad6c\ud604"}),"\n",(0,s.jsx)(n.h3,{id:"1\ufe0f\u20e3-\uc2a4\ud0a4\ub9c8-\uc608\uc2dc",children:"1\ufe0f\u20e3 \uc2a4\ud0a4\ub9c8 \uc608\uc2dc"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"CREATE TABLE remittance_outbox (\r\n  id            BIGINT       PRIMARY KEY AUTO_INCREMENT,\r\n  aggregate_id  BIGINT       NOT NULL,\r\n  event_type    VARCHAR(50)  NOT NULL,\r\n  payload       JSONB        NOT NULL,\r\n  status        VARCHAR(20)  DEFAULT 'PENDING',\r\n  created_at    TIMESTAMP    DEFAULT now()\r\n);\n"})}),"\n",(0,s.jsx)(n.h3,{id:"2\ufe0f\u20e3-\uc5d4\ud2f0\ud2f0--\ub808\ud3ec\uc9c0\ud1a0\ub9ac",children:"2\ufe0f\u20e3 \uc5d4\ud2f0\ud2f0 & \ub808\ud3ec\uc9c0\ud1a0\ub9ac"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:'@Entity\r\n@Table(name = "remittance_outbox")\r\npublic class OutboxEvent {\r\n    @Id @GeneratedValue\r\n    private Long id;\r\n    private Long aggregateId;\r\n    private String eventType;\r\n    @Type(JsonType.class)\r\n    private String payload;\r\n    private String status = "PENDING";\r\n    // \u2026getter/setter\r\n}\n'})}),"\n",(0,s.jsxs)(n.h3,{id:"3\ufe0f\u20e3-\ube44\uc988\ub2c8\uc2a4-\uc11c\ube44\uc2a4-\ub0b4-\ud55c-\ud2b8\ub79c\uc7ad\uc158",children:["3\ufe0f\u20e3 \ube44\uc988\ub2c8\uc2a4 \uc11c\ube44\uc2a4 \ub0b4 ",(0,s.jsx)(n.strong,{children:"\ud55c \ud2b8\ub79c\uc7ad\uc158"})]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:'@Transactional\r\npublic void withdraw(RemittanceCommand cmd) {\r\n    account.decrease(cmd.amount());\r\n    remittanceTxRepo.save(tx);\r\n\r\n    OutboxEvent evt = OutboxEvent.of(tx.getId(), "WITHDRAW_COMPLETED", mapper.writeValueAsString(tx));\r\n    outboxRepo.save(evt);\r\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"4\ufe0f\u20e3-debezium-connector-\uc124\uc815",children:"4\ufe0f\u20e3 Debezium Connector \uc124\uc815"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\r\n  "name": "outbox-connector",\r\n  "config": {\r\n    "connector.class": "io.debezium.connector.mysql.MySqlConnector",\r\n    "database.hostname": "mysql",\r\n    "database.user": "debezium",\r\n    "database.password": "dbz",\r\n    "table.include.list": "bank.remittance_outbox",\r\n    "transforms": "unwrap,route",\r\n    "transforms.unwrap.type": "io.debezium.transforms.ExtractNewRecordState",\r\n    "transforms.route.type": "org.apache.kafka.connect.transforms.RegexRouter",\r\n    "transforms.route.regex": "bank.remittance_outbox",\r\n    "transforms.route.replacement": "ledger-events"\r\n  }\r\n}\n'})}),"\n",(0,s.jsxs)(n.p,{children:["Debezium \u2192 Kafka Connect \uac00 ",(0,s.jsx)(n.code,{children:"ledger-events"})," \ud1a0\ud53d\uc73c\ub85c \ubc00\uc5b4\uc8fc\uba70, ",(0,s.jsx)(n.strong,{children:"Exactly-Once"})," \ubcf4\uc7a5\uc744 \uc704\ud574\r\n",(0,s.jsx)(n.code,{children:"transactional.id"})," \uc640 ",(0,s.jsx)(n.code,{children:"enable.idempotence=true"})," \uc124\uc815\uc744 \ud568\uaed8 \uc0ac\uc6a9\ud569\ub2c8\ub2e4."]}),"\n",(0,s.jsx)(n.h2,{id:"94-armeria-\ud658\uacbd-\ud301",children:"9.4 Armeria \ud658\uacbd \ud301"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Armeria \uc11c\ubc84\uc5d0 ",(0,s.jsx)(n.strong,{children:"CDC \uacb0\uacfc Consumer"})," \ub97c \uad6c\ud604\ud574\ub3c4 \ub418\uc9c0\ub9cc,\r\n\ubcf4\ud1b5 Spring Kafka \ub9ac\uc2a4\ub108\ub97c \ubcc4\ub3c4 \ubaa8\ub4c8\ub85c \ub450\uace0 Armeria \ucabd\uc73c\ub85c gRPC \ud638\ucd9c\ub9cc \uc704\uc784\ud569\ub2c8\ub2e4."]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"95-\uc815\ub9ac",children:"9.5 \uc815\ub9ac"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"DB Tx \u2194 \uc774\ubca4\ud2b8"})," \ubd88\uc77c\uce58\ub97c \uc81c\uac70"]}),"\n",(0,s.jsx)(n.li,{children:"Debezium + Kafka Connect \ub85c \uad6c\ud604 \ub09c\uc774\ub3c4 \u2193"}),"\n",(0,s.jsxs)(n.li,{children:["\ubcf4\uc0c1 \ud2b8\ub79c\uc7ad\uc158\uacfc \ud568\uaed8 \uc4f0\uba74 ",(0,s.jsx)(n.strong,{children:"\uae08\uc735\uad8c \uac10\uc0ac \uc694\uac74 \ucda9\uc871"})]}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}}}]);