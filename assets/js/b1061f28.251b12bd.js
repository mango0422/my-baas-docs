"use strict";(self.webpackChunkmy_baas_docs=self.webpackChunkmy_baas_docs||[]).push([[129],{1990:(e,r,n)=>{n.d(r,{R:()=>c,x:()=>d});var t=n(758);const s={},i=t.createContext(s);function c(e){const r=t.useContext(i);return t.useMemo((function(){return"function"==typeof e?e(r):{...r,...e}}),[r,e])}function d(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:c(e.components),t.createElement(i.Provider,{value:r},e.children)}},2603:(e,r,n)=>{n.r(r),n.d(r,{assets:()=>o,contentTitle:()=>d,default:()=>p,frontMatter:()=>c,metadata:()=>t,toc:()=>a});const t=JSON.parse('{"id":"msa-architecture/11-grpc-deep-dive","title":"11. gRPC \uc644\uc804 \uc815\ubcf5: Spring Boot & Armeria","description":"gRPC \ub294 HTTP/2 + Protobuf \uae30\ubc18\uc758 \uace0\uc131\ub2a5 RPC \ud504\ub808\uc784\uc6cc\ud06c\uc785\ub2c8\ub2e4.","source":"@site/docs/msa-architecture/11-grpc-deep-dive.mdx","sourceDirName":"msa-architecture","slug":"/msa-architecture/11-grpc-deep-dive","permalink":"/my-baas-docs/docs/msa-architecture/11-grpc-deep-dive","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/msa-architecture/11-grpc-deep-dive.mdx","tags":[],"version":"current","sidebarPosition":12,"frontMatter":{"id":"11-grpc-deep-dive","title":"11. gRPC \uc644\uc804 \uc815\ubcf5: Spring Boot & Armeria","sidebar_position":12},"sidebar":"tutorialSidebar","previous":{"title":"10. \uba40\ud2f0 \ud14c\ub10c\uc2dc MSA \uc804\ub7b5","permalink":"/my-baas-docs/docs/msa-architecture/10-multi-tenancy-msa"},"next":{"title":"12. \uace0\uac00\uc6a9\uc131\uc744 \uc704\ud55c Resilience \ud328\ud134","permalink":"/my-baas-docs/docs/msa-architecture/12-resilience-patterns"}}');var s=n(6070),i=n(1990);const c={id:"11-grpc-deep-dive",title:"11. gRPC \uc644\uc804 \uc815\ubcf5: Spring Boot & Armeria",sidebar_position:12},d=void 0,o={},a=[{value:"11.1 .proto \uc815\uc758",id:"111-proto-\uc815\uc758",level:2},{value:"11.2 Spring Boot \uc11c\ubc84",id:"112-spring-boot-\uc11c\ubc84",level:2},{value:"11.3 Armeria \ud1b5\ud569",id:"113-armeria-\ud1b5\ud569",level:2},{value:"\ub2e8\uc77c \ud3ec\ud2b8\uc5d0\uc11c <strong>REST + gRPC + WebSocket</strong> \uc218\uc6a9",id:"\ub2e8\uc77c-\ud3ec\ud2b8\uc5d0\uc11c-rest--grpc--websocket-\uc218\uc6a9",level:3},{value:"11.4 \ud074\ub77c\uc774\uc5b8\ud2b8: Stream &amp; Metadata",id:"114-\ud074\ub77c\uc774\uc5b8\ud2b8-stream--metadata",level:2},{value:"11.5 \ubcf4\uc548: mTLS &amp; JWK",id:"115-\ubcf4\uc548-mtls--jwk",level:2},{value:"11.6 \ubaa8\ub2c8\ud130\ub9c1",id:"116-\ubaa8\ub2c8\ud130\ub9c1",level:2}];function l(e){const r={blockquote:"blockquote",code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(r.blockquote,{children:["\n",(0,s.jsxs)(r.p,{children:[(0,s.jsx)(r.strong,{children:"gRPC"})," \ub294 HTTP/2 + Protobuf \uae30\ubc18\uc758 \uace0\uc131\ub2a5 RPC \ud504\ub808\uc784\uc6cc\ud06c\uc785\ub2c8\ub2e4."]}),"\n"]}),"\n",(0,s.jsx)(r.h2,{id:"111-proto-\uc815\uc758",children:"11.1 .proto \uc815\uc758"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-proto",children:'syntax = "proto3";\r\npackage baas.grpc.account.deposit;\r\noption java_multiple_files = true;\r\n\r\nservice DepositService {\r\n  rpc Deposit (DepositRequest) returns (DepositResponse);\r\n}\r\n\r\nmessage DepositRequest { string accountId = 1; double amount = 2; }\r\nmessage DepositResponse { bool success = 1; string txId = 2; string message = 3; }\n'})}),"\n",(0,s.jsx)(r.h2,{id:"112-spring-boot-\uc11c\ubc84",children:"11.2 Spring Boot \uc11c\ubc84"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-gradle",children:"plugins {\r\n  id 'java'\r\n  id 'com.google.protobuf' version '0.9.5'\r\n}\r\n\r\ndependencies {\r\n  implementation 'io.grpc:grpc-netty-shaded:1.70.0'\r\n  implementation 'net.devh:grpc-server-spring-boot-starter:2.15.0.RELEASE'\r\n}\r\n\r\n@GrpcService\r\npublic class DepositGrpcService extends DepositServiceGrpc.DepositServiceImplBase {\r\n  @Override\r\n  public void deposit(DepositRequest req, StreamObserver<DepositResponse> obs) {\r\n      // \u2026\ub3c4\uba54\uc778 \ub85c\uc9c1\r\n      obs.onNext(resp);\r\n      obs.onCompleted();\r\n  }\r\n}\n"})}),"\n",(0,s.jsx)(r.h2,{id:"113-armeria-\ud1b5\ud569",children:"11.3 Armeria \ud1b5\ud569"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-gradle",children:"implementation 'com.linecorp.armeria:armeria-grpc:1.32.0'\n"})}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-java",children:'Server server = Server\r\n    .builder()\r\n    .http(8080)\r\n    .service(GrpcService.builder()\r\n        .addService(new DepositGrpcService())\r\n        .enableReflection()\r\n        .build())\r\n    .service("/docs/**", new DocService())   // REST + gRPC \ubb38\uc11c\r\n    .build();\r\nserver.start().join();\n'})}),"\n",(0,s.jsxs)(r.h3,{id:"\ub2e8\uc77c-\ud3ec\ud2b8\uc5d0\uc11c-rest--grpc--websocket-\uc218\uc6a9",children:["\ub2e8\uc77c \ud3ec\ud2b8\uc5d0\uc11c ",(0,s.jsx)(r.strong,{children:"REST + gRPC + WebSocket"})," \uc218\uc6a9"]}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsxs)(r.li,{children:["Armeria\ub294 ",(0,s.jsx)(r.code,{children:"content-type"})," \ub124\uace0\ub85c \ud504\ub85c\ud1a0\ucf5c \uc790\ub3d9 \uc2a4\uc704\uce6d"]}),"\n",(0,s.jsxs)(r.li,{children:["Swagger/OpenAPI \u2192 ",(0,s.jsx)(r.code,{children:"armeria-retrofit"})," \ub3c4\uad6c\ub85c REST \ud074\ub77c\uc774\uc5b8\ud2b8 \uc0dd\uc131"]}),"\n"]}),"\n",(0,s.jsx)(r.h2,{id:"114-\ud074\ub77c\uc774\uc5b8\ud2b8-stream--metadata",children:"11.4 \ud074\ub77c\uc774\uc5b8\ud2b8: Stream & Metadata"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-java",children:'ManagedChannel ch = ManagedChannelBuilder.forAddress("remit", 8443)\r\n                                          .usePlaintext()\r\n                                          .build();\r\nDepositServiceGrpc.DepositServiceStub stub =\r\n    MetadataUtils.attachHeaders(DepositServiceGrpc.newStub(ch), tenantMetadata);\r\nstub.deposit(req, obs);\n'})}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.strong,{children:"Bidirectional Stream"}),": ",(0,s.jsx)(r.code,{children:"depositChat()"})," \ucc98\ub7fc \uc2e4\uc2dc\uac04 \uc0c1\ud0dc \uc54c\ub9bc"]}),"\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.strong,{children:"Deadline & Retry"}),": ",(0,s.jsx)(r.code,{children:"stub.withDeadlineAfter(3, TimeUnit.SECONDS)"})," + ",(0,s.jsx)(r.code,{children:"retryPolicy"})]}),"\n"]}),"\n",(0,s.jsx)(r.h2,{id:"115-\ubcf4\uc548-mtls--jwk",children:"11.5 \ubcf4\uc548: mTLS & JWK"}),"\n",(0,s.jsxs)(r.ol,{children:["\n",(0,s.jsxs)(r.li,{children:["Spring Boot \u2013 ",(0,s.jsx)(r.code,{children:"grpc.ssl.enabled=true"})," + cert / key"]}),"\n",(0,s.jsxs)(r.li,{children:["Armeria \u2013 ",(0,s.jsx)(r.code,{children:"TlsConfig.builder().keyManager(cert, key).build()"})]}),"\n",(0,s.jsxs)(r.li,{children:["JWT \uc778\uc99d \u2192 ",(0,s.jsx)(r.code,{children:"AuthInterceptor"})," \ub85c ",(0,s.jsx)(r.code,{children:"Metadata"})," \ud1a0\ud070 \uac80\uc99d (JWK \uce90\uc2dc)"]}),"\n"]}),"\n",(0,s.jsx)(r.h2,{id:"116-\ubaa8\ub2c8\ud130\ub9c1",children:"11.6 \ubaa8\ub2c8\ud130\ub9c1"}),"\n",(0,s.jsxs)(r.table,{children:[(0,s.jsx)(r.thead,{children:(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.th,{children:"\uc9c0\ud45c"}),(0,s.jsx)(r.th,{children:"\ubc29\ubc95"})]})}),(0,s.jsxs)(r.tbody,{children:[(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:"QPS\xb7p95"}),(0,s.jsxs)(r.td,{children:[(0,s.jsx)(r.code,{children:"grpc_server_handled_duration_seconds"})," Prometheus"]})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:"\uba54\uc2dc\uc9c0 \ud06c\uae30"}),(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"grpc_server_msg_received_total"})})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:"\uc5d0\ub7ec\uc728"}),(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:'grpc_server_handled_total{code!~"OK"}'})})]})]})]}),"\n",(0,s.jsxs)(r.p,{children:["OpenTelemetry ",(0,s.jsx)(r.code,{children:"GrpcTracing"})," \ub85c Trace ID \uc790\ub3d9 \uc0bd\uc785."]})]})}function p(e={}){const{wrapper:r}={...(0,i.R)(),...e.components};return r?(0,s.jsx)(r,{...e,children:(0,s.jsx)(l,{...e})}):l(e)}}}]);